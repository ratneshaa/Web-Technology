<!DOCTYPE html>
<html>
<head>
    <title>Real-Time User Activity Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f2f2f2;
        }

        #container {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            max-width: 800px;
            margin: auto;
        }

        #log {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background: #fafafa;
        }

        .log-item {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .warning {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }

        button {
            margin-top: 10px;
            padding: 8px 15px;
            cursor: pointer;
        }

        input {
            padding: 5px;
            margin-top: 10px;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="container">
    <h2>User Activity Monitor</h2>

    <p>Interact with the page (click, type, focus input) to generate activity logs.</p>

    <input type="text" placeholder="Focus and type here..." />

    <div id="warning" class="warning"></div>

    <div id="log"></div>

    <button id="resetBtn">Reset & Export Log</button>
</div>

<script>
    // 2. Store activities in an array
    const activityLog = [];

    let clickCount = 0;
    const CLICK_THRESHOLD = 10;

    const logDiv = document.getElementById("log");
    const warningDiv = document.getElementById("warning");

    // Utility function to log activity
    function logActivity(type, target, eventPhase) {
        const activity = {
            type: type,
            target: target.tagName,
            time: new Date().toLocaleTimeString(),
            phase: eventPhase === 1 ? "Capturing" :
                   eventPhase === 2 ? "Target" : "Bubbling"
        };

        activityLog.push(activity);
        displayActivity(activity);
    }

    // 4. Dynamically display logs
    function displayActivity(activity) {
        const div = document.createElement("div");
        div.className = "log-item";
        div.innerText = `[${activity.time}] ${activity.type} on ${activity.target} (${activity.phase})`;
        logDiv.appendChild(div);
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    // 5. Suspicious activity detection
    function checkSuspiciousActivity() {
        if (clickCount >= CLICK_THRESHOLD) {
            warningDiv.innerText = "âš  Suspicious activity detected: Too many clicks!";
        }
    }

    // 1 & 3. Event listeners (capturing + bubbling)

    // Click events
    document.addEventListener("click", function (e) {
        clickCount++;
        logActivity("Click", e.target, e.eventPhase);
        checkSuspiciousActivity();
    }, true); // Capturing

    document.addEventListener("click", function (e) {
        logActivity("Click", e.target, e.eventPhase);
    }, false); // Bubbling

    // Key press events
    document.addEventListener("keydown", function (e) {
        logActivity(`Key Press (${e.key})`, e.target, e.eventPhase);
    }, true);

    // Focus events (use focusin to allow bubbling)
    document.addEventListener("focusin", function (e) {
        logActivity("Focus", e.target, e.eventPhase);
    }, true);

    // 6. Reset & Export
    document.getElementById("resetBtn").addEventListener("click", function () {
        let exportText = "User Activity Log\n-----------------\n";

        activityLog.forEach((a, index) => {
            exportText += `${index + 1}. [${a.time}] ${a.type} on ${a.target} (${a.phase})\n`;
        });

        alert(exportText);

        // Reset everything
        activityLog.length = 0;
        logDiv.innerHTML = "";
        warningDiv.innerText = "";
        clickCount = 0;
    });
</script>

</body>
</html>
